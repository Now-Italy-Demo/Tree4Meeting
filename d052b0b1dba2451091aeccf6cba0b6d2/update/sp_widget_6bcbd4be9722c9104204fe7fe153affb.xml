<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope, spUtil) {
	/* widget controller */
	var c = this;
	var bad = 0, good = 0;

	google.charts.load("current", {packages:["corechart"]});
	google.charts.setOnLoadCallback(drawChart);
	
	function drawChart() {		
		Object.keys(c.data.mezzi_di_trasporto).forEach(function(single) {
			switch(single){
				case "Aereo":
				case "Veicolo a combustione":
					bad += c.data.mezzi_di_trasporto[single]
					break;
				default:
					good += c.data.mezzi_di_trasporto[single]
					break;
			}
		})
		
		var data = google.visualization.arrayToDataTable([
			['Task', 'Hours per Day'],
			['Molto inquinante',  bad],
			['Non inquinante',    good]
		]);

		var options = {
			pieHole: 0.5 ,
			'width': 200,
			'height': 200,
			'chartArea': {'width': '90%', 'height': '90%'},
			'legend': {'position': 'none'},
			'pieSliceText': 'none',
			colors: ['#f43d18', '#7bd808']
		};

		var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
		chart.draw(data, options);
	}

	setInterval(function(){
		good = 0;
		bad = 0;
		spUtil.update($scope);
		drawChart()
	}, 5000);

};]]></client_script>
        <controller_as>c</controller_as>
        <css>.card {
  min-height: 35rem;
  background-color: #ffffff;
  margin-bottom: 1rem;
  border-radius: .6rem;
  padding: 3rem;
  margin-top: 3rem;
  box-shadow:0 0.4rem 0.8rem 0 rgba(23, 40, 52 , 8%)

}

.card-title {
  font-weight: 600;
  font-size: 2rem;
  //  position: absolute;
  z-index: 1;
}


#donutchart{
  text-align: -webkit-center;
  margin-top:2rem;
}

.donut-caption{
  font-size: 1rem;
}

.value{
  text-align: center;
  margin-top: -123px;
  position: relative;
}

.legends{
  bottom: 35px;
  text-align:center;
	left:0;
  right:0;
}

.ready{
  color: #7bd808;
}
.notReady{
  color: #f43d18;
}

.fa-circle{
  margin-left:20px;
  margin-right:5px;
}


</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>t4m_return_to_workplace</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>T4M - Return to Workplace</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	
	data.mezzi_di_trasporto = {
		"Treno/Metro": 0,
		"Aereo": 0,
		"Veicolo elettrico":0,
		"Veicolo a combustione":0,
		"Bicicletta":0,
		"Piedi":0
	};

	//var gr = new GlideRecord('x_snc_tree4meeting_attendee');
	//gr.query('event_name=e85a2d4e4726c510d06e1d51e36d4305');
	//gr.groupBy('mezzo_di_trasporto');
	//gr.orderByDesc('sys_updated_on');
	//gr.query();
	
	//while(gr.next()){
		//data.partecipante.push(gr)
	//}
	
	var agg = new GlideAggregate('x_snc_tree4meeting_attendee');
	agg.addAggregate("COUNT", "mezzo_di_trasporto");
	agg.addQuery('event_name=e85a2d4e4726c510d06e1d51e36d4305');
	agg.query();

	while (agg.next()) {
			var frequenzaMezzo = agg.getAggregate('COUNT', 'mezzo_di_trasporto');
			var mezzo = agg.getDisplayValue('mezzo_di_trasporto');
			data.mezzi_di_trasporto[mezzo] = Number(frequenzaMezzo)
	}
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>francesco</sys_created_by>
        <sys_created_on>2022-04-02 17:24:49</sys_created_on>
        <sys_id>6bcbd4be9722c9104204fe7fe153affb</sys_id>
        <sys_mod_count>23</sys_mod_count>
        <sys_name>T4M - Return to Workplace</sys_name>
        <sys_package display_value="Tree4Meeting" source="x_snc_tree4meeting">d052b0b1dba2451091aeccf6cba0b6d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Tree4Meeting">d052b0b1dba2451091aeccf6cba0b6d2</sys_scope>
        <sys_update_name>sp_widget_6bcbd4be9722c9104204fe7fe153affb</sys_update_name>
        <sys_updated_by>francesco</sys_updated_by>
        <sys_updated_on>2022-04-04 08:39:02</sys_updated_on>
        <template><![CDATA[<div class = "card" id = "return-to-workplace">
  <div class="card-title">
    Distribuzione mezzi di trasporto
  </div>

  <div id="donutchart" ></div>
  
  <div class = "legends">
    <i class="fa fa-circle ready"></i>Non inquinante <i class="fa fa-circle notReady"></i> Mezzo inquinante
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
