<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope) {
	/* widget controller */
	var c = this;
	
	google.charts.load("current", {packages:["corechart"]});
	google.charts.setOnLoadCallback(drawChart);
	
	function drawChart() {
		var dataTable = []
	dataTable.push(['Task', 'Mezzo'])
			
	Object.keys(c.data.mezzi_di_trasporto).forEach(function(el){
		dataTable.push([el, c.data.mezzi_di_trasporto[el]])
	})
	
	console.log(dataTable);
	
	
		var data = google.visualization.arrayToDataTable(dataTable);

		/*
		var data = google.visualization.arrayToDataTable([
          ['Task', 'Mezzo'],
          ['Work',     1],
          ['Eat',      1],
          ['Commute',  1],
          ['Watch TV', 1],
          ['Sleep',    1]
        ]);
		*/
		
		var options = {
			chartArea: {'width': '90%', 'height': '90%'},
			legend: {'position': 'none'},
			pieSliceText: "percentage",
			colors: ["#35a79d","#FFC54D","#FF8C72","#38aaf4","#2A3D40","#db63dd"]
		};

		var chart = new google.visualization.PieChart(document.getElementById('donutchart-vaccination-status'));
		chart.draw(data, options);
		
			console.log(dataTable);

	}

};]]></client_script>
        <controller_as>c</controller_as>
        <css>.card {
  min-height: 35rem;
  background-color: #ffffff;
  margin-bottom: 1rem;
  border-radius: .6rem;
  padding: 3rem 2rem;
  margin-top: 3rem;
  box-shadow:0 0.4rem 0.8rem 0 rgba(23, 40, 52 , 8%)

}

.card-title {
  font-weight: 600;
  font-size: 2rem;
  //  position: absolute;
  z-index: 1;
}


#donutchart-vaccination-status{
//  text-align: -webkit-center;
  margin-top:2rem;
  width: 200px;
  height: 200px;
}

.donut-caption{
  font-size: 1rem;
}

.value{
  text-align: center;
  margin-top: -123px;
  position: relative;
}

.legends{
  text-align: left;
  left: 0;
  right: 0;
  margin-top:4rem;
}

.right{}


.legend-item{
	margin-top:15px;
}

.trenometro{
color: #35a79d;
}

.aereo{
color: #FFC54D;
}

.veicoloelettrico{
  color: #FF8C72;
}

.veicolocombustione{
  color: #38aaf4;
}

.bicicletta{
  color: #2A3D40;
}

.piedi{
  color: #db63dd;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>t4m_vaccination_status</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>T4M - Vaccination Status</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	
	data.mezzi_di_trasporto = {
		"Treno/Metro": 0,
		"Aereo": 0,
		"Veicolo elettrico":0,
		"Veicolo a combustione":0,
		"Bicicletta":0,
		"Piedi":0
	};

	//var gr = new GlideRecord('x_snc_tree4meeting_attendee');
	//gr.query('event_name=e85a2d4e4726c510d06e1d51e36d4305');
	//gr.groupBy('mezzo_di_trasporto');
	//gr.orderByDesc('sys_updated_on');
	//gr.query();
	
	//while(gr.next()){
		//data.partecipante.push(gr)
	//}
	
	var agg = new GlideAggregate('x_snc_tree4meeting_attendee');
	agg.addAggregate("COUNT", "mezzo_di_trasporto");
	agg.addQuery('event_name=e85a2d4e4726c510d06e1d51e36d4305');
	agg.query();

	while (agg.next()) {
			var frequenzaMezzo = agg.getAggregate('COUNT', 'mezzo_di_trasporto');
			var mezzo = agg.getDisplayValue('mezzo_di_trasporto');
			data.mezzi_di_trasporto[mezzo] = Number(frequenzaMezzo)
	}
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>francesco</sys_created_by>
        <sys_created_on>2022-04-02 17:20:10</sys_created_on>
        <sys_id>a3bad43e9722c9104204fe7fe153af5d</sys_id>
        <sys_mod_count>58</sys_mod_count>
        <sys_name>T4M - Vaccination Status</sys_name>
        <sys_package display_value="Tree4Meeting" source="x_snc_tree4meeting">d052b0b1dba2451091aeccf6cba0b6d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Tree4Meeting">d052b0b1dba2451091aeccf6cba0b6d2</sys_scope>
        <sys_update_name>sp_widget_a3bad43e9722c9104204fe7fe153af5d</sys_update_name>
        <sys_updated_by>francesco</sys_updated_by>
        <sys_updated_on>2022-04-02 21:43:38</sys_updated_on>
        <template><![CDATA[<div class = "card" id = "vaccination-status">
  <div class="card-title">
    Mezzi di trasporto utilizzati
  </div>

  <div class = "row legend-item">
    <div id="donutchart-vaccination-status" class = "col-md-7" ></div>
    
    <div class = "legends col-md-5">
      <div class = "row">
        <div class = "col-md-1">
          <i class = "fa fa-square trenometro"></i>
        </div>
        <div class = "col-md-9">Treno/Metro
        </div>
      </div>


      <div class = "row legend-item">
        <div class = "col-md-1">
          <i class = "fa fa-square aereo"></i>
        </div>
        <div class = "col-md-9">Aereo
        </div>
      </div>

      <div class = "row legend-item">
        <div class = "col-md-1">
          <i class = "fa fa-square veicoloelettrico"></i>
        </div>
        <div class = "col-md-9">Veicolo elettrico
        </div>
      </div>

      <div class = "row legend-item">
        <div class = "col-md-1">
          <i class = "fa fa-square veicolocombustione"></i>
        </div>
        <div class = "col-md-9">Veicolo a combustione
        </div>
      </div>

      <div class = "row legend-item">
        <div class = "col-md-1">
          <i class = "fa fa-square bicicletta"></i>
        </div>
        <div class = "col-md-9">Bicicletta
        </div>
      </div>

      <div class = "row legend-item">
        <div class = "col-md-1">
          <i class = "fa fa-square piedi"></i>
        </div>
        <div class = "col-md-9">Piedi
        </div>
      </div>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
